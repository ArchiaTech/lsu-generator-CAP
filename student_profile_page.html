<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📋 Fiche Élève - LSU École Primaire</title>
    <style>
        /* Barre de Navigation LSU */
        .nav-bar {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid #3498db;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            height: 70px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
        }

        .logo-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .logo-link:hover {
            transform: scale(1.05);
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }

        .logo-icon {
            font-size: 1.8em;
            margin-right: 10px;
        }

        .logo-text {
            background: linear-gradient(45deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .nav-link.active {
            background: rgba(52, 152, 219, 0.3);
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
        }

        .nav-icon {
            font-size: 1.2em;
        }

        .nav-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }

        .nav-toggle span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 70px);
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                flex-direction: column;
                padding: 20px;
                transition: left 0.3s;
                gap: 10px;
            }

            .nav-menu.active {
                left: 0;
            }

            .nav-link {
                width: 100%;
                justify-content: center;
                padding: 15px;
                font-size: 1.1em;
            }

            .nav-toggle {
                display: flex;
            }

            .nav-toggle.active span:nth-child(1) {
                transform: rotate(45deg) translate(5px, 5px);
            }

            .nav-toggle.active span:nth-child(2) {
                opacity: 0;
            }

            .nav-toggle.active span:nth-child(3) {
                transform: rotate(-45deg) translate(7px, -6px);
            }
        }

        /* Animation d'entrée */
        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .nav-bar {
            animation: slideInDown 0.5s ease-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Barre de navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            margin: -20px -20px 20px -20px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .nav-logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            text-decoration: none;
            color: #2c3e50;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover, .nav-link.active {
            background: #4CAF50;
            color: white;
            transform: translateY(-2px);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-info h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header-info p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .student-photo-container {
            position: relative;
        }

        .student-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .student-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .photo-actions {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .photo-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            margin: 0 5px;
        }

        .student-photo:hover .photo-actions {
            opacity: 1;
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .tab:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab.active {
            background: #4CAF50;
            color: white;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }

        .info-card:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #555;
        }

        .info-value {
            color: #2c3e50;
            text-align: right;
        }

        .competences-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .competence-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4CAF50;
        }

        .competence-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .competence-level {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .level-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e0e0e0;
            border: 2px solid #ccc;
        }

        .level-dot.active {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        .competence-comment {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        .evaluation-history {
            margin-top: 20px;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -37px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #e9ecef;
        }

        .timeline-date {
            font-weight: 600;
            color: #4CAF50;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .timeline-content {
            color: #2c3e50;
            line-height: 1.5;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Styles pour les nouveaux boutons d'import/export */
        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        /* Container pour les nouveaux boutons */
        .d-flex.gap-2.mb-3 {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .d-flex.gap-2.mb-3 button {
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 140px;
        }

        .d-flex.gap-2.mb-3 button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Responsive pour les nouveaux boutons */
        @media (max-width: 768px) {
            .d-flex.gap-2.mb-3 {
                flex-direction: column;
                gap: 10px;
            }
            
            .d-flex.gap-2.mb-3 button {
                width: 100%;
                min-width: auto;
            }
        }

        .actions-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #4CAF50;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.show {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.warning {
            background: #ff9800;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .tabs {
                flex-direction: column;
                gap: 5px;
            }

            .tab {
                min-width: auto;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .actions-bar {
                flex-direction: column;
            }
        }

        /* Styles pour le modal photo */
        .photo-modal {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .photo-display {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .photo-preview {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-options {
            margin: 20px 0;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .emoji-btn {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .emoji-btn:hover {
            border-color: #4CAF50;
            background: #f8f9fa;
            transform: scale(1.1);
        }

        .emoji-btn.selected {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
        }

        /* Amélioration des styles de la photo */
        .student-photo-container {
            position: relative;
            cursor: pointer;
        }

        .student-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            border: 3px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
            overflow: hidden;
        }

        .student-photo:hover {
            transform: scale(1.05);
            border-color: rgba(255,255,255,0.5);
        }

        .student-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .photo-actions {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
        }

        .photo-btn {
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .photo-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .student-photo-container:hover .photo-actions {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Barre de Navigation LSU -->
    <nav class="nav-bar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html" class="logo-link">
                    <span class="logo-icon">🎓</span>
                    <span class="logo-text">LSU Pro</span>
                </a>
            </div>
            
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">
                    <span class="nav-icon">🏠</span>
                    Accueil
                </a>
                <a href="improved_lsu_generator.html" class="nav-link">
                    <span class="nav-icon">📝</span>
                    Générateur LSU
                </a>
                <a href="student_profile_page.html" class="nav-link">
                    <span class="nav-icon">👤</span>
                    Profils Élèves
                </a>
                <a href="photos_classe_pro.html" class="nav-link">
                    <span class="nav-icon">📸</span>
                    Photos Classe
                </a>
                <a href="lsu_connection_test.html" class="nav-link">
                    <span class="nav-icon">🔧</span>
                    Tests Connexion
                </a>
                <a href="test_navigation.html" class="nav-link">
                    <span class="nav-icon">🧭</span>
                    Navigation
                </a>
            </div>
            
            <div class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Barre de navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="lsu_index.html" class="nav-logo">🎓 LSU École Primaire</a>
            
            <ul class="nav-menu" id="navMenu">
                <li class="nav-item">
                    <a href="lsu_index.html" class="nav-link">
                        🏠 Accueil
                    </a>
                </li>
                <li class="nav-item">
                    <a href="improved_lsu_generator.html" class="nav-link">
                        ✨ Générateur
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link active">
                        👤 Profil Élève
                    </a>
                </li>
            </ul>

            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">☰</button>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <div class="header-info">
                <h1 id="studentFullName">Léa Martin</h1>
                <p id="studentDetails">CM1 - 9 ans - Née le 15/03/2015</p>
            </div>
            <div class="student-photo-container">
                <div class="student-photo" id="studentPhoto" onclick="showPhotoModal()">
                    <img id="studentPhotoImg" src="" alt="Photo de l'élève" style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    <span id="studentPhotoEmoji">👧</span>
                </div>
                <div class="photo-actions">
                    <button class="photo-btn" onclick="showPhotoModal()" title="Voir la photo">
                        👁️
                    </button>
                    <button class="photo-btn" onclick="editPhoto()" title="Modifier la photo">
                        ✏️
                    </button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="generateComment()">
                    ✨ Générer commentaire
                </button>
                <button class="btn btn-secondary" onclick="openEvaluationModal()">
                    📝 Nouvelle évaluation
                </button>
                <button class="btn btn-warning" onclick="editStudent()">
                    ✏️ Modifier profil
                </button>
                <a href="#" class="btn btn-secondary" onclick="goBack()">
                    ← Retour à la liste
                </a>
            </div>

            <!-- Nouveaux boutons de gestion des élèves -->
            <div class="d-flex gap-2 mb-3" style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="window.location.href='create_student.html'" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
                    ➕ Créer un élève
                </button>
                <button class="btn btn-primary" onclick="window.location.href='student_list.html'" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
                    📋 Liste des élèves
                </button>
                <input type="file" id="importFile" accept=".csv, .xlsx" style="display:none" onchange="handleImport(event)">
                <button class="btn btn-warning" onclick="document.getElementById('importFile').click()" style="background: #ffc107; color: #212529; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
                    📥 Importer une liste
                </button>
                <button class="btn btn-info" onclick="handleExport()" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
                    📤 Exporter la liste
                </button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('overview')">
                    🏠 Vue d'ensemble
                </button>
                <button class="tab" onclick="showTab('competences')">
                    🎯 Compétences
                </button>
                <button class="tab" onclick="showTab('evaluations')">
                    📊 Évaluations
                </button>
                <button class="tab" onclick="showTab('comments')">
                    💬 Commentaires
                </button>
                <button class="tab" onclick="showTab('family')">
                    👨‍👩‍👧‍👦 Famille
                </button>
            </div>

            <!-- Onglet Vue d'ensemble -->
            <div id="overview" class="tab-content active">
                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="averageLevel">2.8</div>
                        <div class="stat-label">Moyenne générale</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="evaluationsCount">12</div>
                        <div class="stat-label">Évaluations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="progressTrend">+15%</div>
                        <div class="stat-label">Progression</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="absenceCount">3</div>
                        <div class="stat-label">Absences</div>
                    </div>
                </div>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="card-title">
                            ℹ️ Informations personnelles
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fratrie :</span>
                            <span class="info-value">1 frère (Tom, 6 ans)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Personne à contacter :</span>
                            <span class="info-value">Mère (priorité)</span>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="card-title">
                            📞 Contacts d'urgence
                        </div>
                        <div class="info-item">
                            <span class="info-label">Grand-mère :</span>
                            <span class="info-value">Marie Dupont<br>01 23 45 67 89</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Autorisation de sortie :</span>
                            <span class="info-value">Parents + Grand-mère</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Allergies :</span>
                            <span class="info-value">Aucune connue</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Traitement médical :</span>
                            <span class="info-value">Aucun</span>
                        </div>
                    </div>
                </div>

                <div class="info-card" style="margin-top: 20px;">
                    <div class="card-title">
                        📝 Notes sur l'environnement familial
                    </div>
                    <p style="color: #666; line-height: 1.6; margin: 15px 0;">
                        Famille très impliquée dans la scolarité. Les parents suivent régulièrement les devoirs et participent aux réunions. 
                        Environnement propice aux apprentissages à la maison. Léa bénéficie d'un soutien familial solide qui se reflète 
                        dans sa motivation et son comportement en classe.
                    </p>
                    <p style="color: #666; line-height: 1.6;">
                        <strong>Remarques particulières :</strong> La mère étant enseignante, elle comprend bien les enjeux pédagogiques 
                        et collabore efficacement avec l'équipe éducative.
                    </p>
                </div>
            </div>

            <!-- Onglet Compétences -->
            <div id="competences" class="tab-content">
                <div class="competences-grid">
                    <div class="competence-card">
                        <div class="competence-title">Français - Lecture</div>
                        <div class="competence-level">
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                            <div class="level-dot"></div>
                            <div class="level-dot"></div>
                        </div>
                        <div class="competence-comment">Bonne compréhension des textes simples</div>
                    </div>
                    
                    <div class="competence-card">
                        <div class="competence-title">Français - Écriture</div>
                        <div class="competence-level">
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                            <div class="level-dot"></div>
                        </div>
                        <div class="competence-comment">Écriture soignée, respect des règles de base</div>
                    </div>
                    
                    <div class="competence-card">
                        <div class="competence-title">Mathématiques - Calcul</div>
                        <div class="competence-level">
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                        </div>
                        <div class="competence-comment">Excellente maîtrise des opérations</div>
                    </div>
                    
                    <div class="competence-card">
                        <div class="competence-title">Mathématiques - Géométrie</div>
                        <div class="competence-level">
                            <div class="level-dot active"></div>
                            <div class="level-dot active"></div>
                            <div class="level-dot"></div>
                            <div class="level-dot"></div>
                        </div>
                        <div class="competence-comment">Connaissance des formes géométriques</div>
                    </div>
                </div>
            </div>

            <!-- Onglet Évaluations -->
            <div id="evaluations" class="tab-content">
                <div class="evaluation-history">
                    <div class="timeline" id="evaluationsTimeline">
                        <!-- Les évaluations seront chargées dynamiquement -->
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="openEvaluationModal()">
                        📝 Ajouter une évaluation
                    </button>
                </div>
            </div>

            <!-- Onglet Commentaires -->
            <div id="comments" class="tab-content">
                <div class="info-card">
                    <div class="card-title">
                        💬 Commentaires généraux
                    </div>
                    <div id="commentsList">
                        <div class="comment-item" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4CAF50;">
                            <div style="font-weight: 600; color: #4CAF50; margin-bottom: 8px;">15/12/2024 - Commentaire trimestriel</div>
                            <p style="color: #333; line-height: 1.6;">
                                Léa est une élève sérieuse et appliquée. Elle participe activement en classe et fait preuve d'une bonne autonomie dans son travail. 
                                Ses progrès en mathématiques sont remarquables. Elle pourrait encore améliorer sa confiance en elle lors des prises de parole.
                            </p>
                        </div>
                        
                        <div class="comment-item" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <div style="font-weight: 600; color: #ffc107; margin-bottom: 8px;">10/11/2024 - Observation comportement</div>
                            <p style="color: #333; line-height: 1.6;">
                                Excellente collaboration avec ses camarades. Léa aide volontiers les autres élèves et fait preuve d'empathie. 
                                Elle respecte bien les règles de vie en classe.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addComment()">
                        💬 Ajouter un commentaire
                    </button>
                </div>
            </div>

            <!-- Onglet Famille -->
            <div id="family" class="tab-content">
                <div class="info-grid">
                    <div class="info-card">
                        <div class="card-title">
                            👨‍👩‍👧‍👦 Informations familiales
                        </div>
                        <div class="info-item">
                            <span class="info-label">Parents :</span>
                            <span class="info-value">Sophie et Pierre Martin</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Profession mère :</span>
                            <span class="info-value">Enseignante (CE1)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Profession père :</span>
                            <span class="info-value">Ingénieur informatique</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fratrie :</span>
                            <span class="info-value">1 frère (Tom, 6 ans, CP)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Situation familiale :</span>
                            <span class="info-value">Famille recomposée</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <div class="card-title">
                            📞 Contacts d'urgence
                        </div>
                        <div class="info-item">
                            <span class="info-label">Mère (priorité) :</span>
                            <span class="info-value">Sophie Martin<br>01 23 45 67 89</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Père :</span>
                            <span class="info-value">Pierre Martin<br>01 98 76 54 32</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Grand-mère :</span>
                            <span class="info-value">Marie Dupont<br>01 45 67 89 12</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Autorisation de sortie :</span>
                            <span class="info-value">Parents + Grand-mère</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-card" style="margin-top: 20px;">
                    <div class="card-title">
                        🏠 Environnement familial
                    </div>
                    <div class="info-item">
                        <span class="info-label">Adresse :</span>
                        <span class="info-value">123 Rue de la Paix, 75001 Paris</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Conditions de vie :</span>
                        <span class="info-value">Confortables</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Soutien scolaire :</span>
                        <span class="info-value">Aide parentale régulière</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Activités extrascolaires :</span>
                        <span class="info-value">Piano, Natation</span>
                    </div>
                </div>
                
                <div class="info-card" style="margin-top: 20px;">
                    <div class="card-title">
                        📝 Notes sur l'environnement familial
                    </div>
                    <p style="color: #666; line-height: 1.6; margin: 15px 0;">
                        Famille très impliquée dans la scolarité. Les parents suivent régulièrement les devoirs et participent aux réunions. 
                        Environnement propice aux apprentissages à la maison. Léa bénéficie d'un soutien familial solide qui se reflète 
                        dans sa motivation et son comportement en classe.
                    </p>
                    <p style="color: #666; line-height: 1.6;">
                        <strong>Remarques particulières :</strong> La mère étant enseignante, elle comprend bien les enjeux pédagogiques 
                        et collabore efficacement avec l'équipe éducative. Le père s'implique également dans le suivi scolaire.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nouvelle Évaluation -->
    <div id="evaluationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEvaluationModal()">&times;</span>
            <h2>📝 Nouvelle évaluation</h2>
            
            <div class="form-group">
                <label for="evaluationDate">Date d'évaluation :</label>
                <input type="date" id="evaluationDate">
            </div>

            <div class="form-group">
                <label for="evaluationSubject">Matière :</label>
                <select id="evaluationSubject">
                    <option value="francais">Français</option>
                    <option value="mathematiques">Mathématiques</option>
                    <option value="sciences">Questionner le monde</option>
                    <option value="arts">Arts plastiques</option>
                    <option value="eps">Éducation physique</option>
                    <option value="langue">Langue vivante</option>
                </select>
            </div>

            <div class="form-group">
                <label for="evaluationDomain">Domaine spécifique :</label>
                <input type="text" id="evaluationDomain" placeholder="Ex: Lecture, Calcul mental, Géométrie...">
            </div>

            <div class="form-group">
                <label>Niveau de maîtrise :</label>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                    <button type="button" class="btn btn-secondary eval-level-btn" data-level="insufficient" onclick="selectEvalLevel('insufficient')">
                        Maîtrise insuffisante
                    </button>
                    <button type="button" class="btn btn-secondary eval-level-btn" data-level="fragile" onclick="selectEvalLevel('fragile')">
                        Maîtrise fragile
                    </button>
                    <button type="button" class="btn btn-secondary eval-level-btn" data-level="satisfactory" onclick="selectEvalLevel('satisfactory')">
                        Maîtrise satisfaisante
                    </button>
                    <button type="button" class="btn btn-secondary eval-level-btn" data-level="excellent" onclick="selectEvalLevel('excellent')">
                        Très bonne maîtrise
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="evaluationComment">Commentaire :</label>
                <textarea id="evaluationComment" rows="4" placeholder="Observations, points positifs, axes d'amélioration..."></textarea>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveEvaluation()">💾 Enregistrer</button>
                <button class="btn btn-secondary" onclick="closeEvaluationModal()">❌ Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal Édition Profil -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>✏️ Modifier le profil de l'élève</h2>
            
            <div class="form-group">
                <label for="editFirstName">Prénom :</label>
                <input type="text" id="editFirstName">
            </div>

            <div class="form-group">
                <label for="editLastName">Nom :</label>
                <input type="text" id="editLastName">
            </div>

            <div class="form-group">
                <label for="editBirthDate">Date de naissance :</label>
                <input type="date" id="editBirthDate">
            </div>

            <div class="form-group">
                <label for="editLevel">Niveau scolaire :</label>
                <select id="editLevel">
                    <option value="CP">CP - Cours Préparatoire</option>
                    <option value="CE1">CE1 - Cours Élémentaire 1ère année</option>
                    <option value="CE2">CE2 - Cours Élémentaire 2ème année</option>
                    <option value="CM1">CM1 - Cours Moyen 1ère année</option>
                    <option value="CM2">CM2 - Cours Moyen 2ème année</option>
                </select>
            </div>

            <div class="form-group">
                <label for="editTeacher">Enseignant(e) :</label>
                <input type="text" id="editTeacher" placeholder="Nom de l'enseignant">
            </div>

            <div class="form-group">
                <label for="editClass">Classe :</label>
                <input type="text" id="editClass" placeholder="Ex: CM1-A, CE2-B...">
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveStudentProfile()">💾 Sauvegarder</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">❌ Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal Photo -->
    <div id="photoModal" class="modal">
        <div class="modal-content photo-modal">
            <span class="close" onclick="closePhotoModal()">&times;</span>
            <h2>📸 Photo de l'élève</h2>
            
            <div class="photo-display">
                <div class="photo-preview" id="photoPreview">
                    <img id="modalPhotoImg" src="" alt="Photo de l'élève" style="display: none; max-width: 100%; max-height: 400px; border-radius: 10px;">
                    <div id="modalPhotoEmoji" style="font-size: 8em; text-align: center; padding: 40px;">👧</div>
                </div>
            </div>
            
            <div class="photo-options">
                <div class="form-group">
                    <label for="photoUpload">📁 Choisir une photo :</label>
                    <input type="file" id="photoUpload" accept="image/*" onchange="handlePhotoUpload(event)">
                </div>
                
                <div class="form-group">
                    <label>🎭 Ou choisir un emoji :</label>
                    <div class="emoji-grid">
                        <button class="emoji-btn" onclick="selectEmoji('👧')">👧</button>
                        <button class="emoji-btn" onclick="selectEmoji('👦')">👦</button>
                        <button class="emoji-btn" onclick="selectEmoji('👩')">👩</button>
                        <button class="emoji-btn" onclick="selectEmoji('👨')">👨</button>
                        <button class="emoji-btn" onclick="selectEmoji('🧒')">🧒</button>
                        <button class="emoji-btn" onclick="selectEmoji('👶')">👶</button>
                        <button class="emoji-btn" onclick="selectEmoji('🎭')">🎭</button>
                        <button class="emoji-btn" onclick="selectEmoji('🌟')">🌟</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-danger" onclick="removePhoto()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                        🗑️ Supprimer la photo
                    </button>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="savePhoto()">💾 Sauvegarder</button>
                <button class="btn btn-secondary" onclick="closePhotoModal()">❌ Annuler</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Script pour la navigation
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.getElementById('navToggle');
            const navMenu = document.getElementById('navMenu');
            const navLinks = document.querySelectorAll('.nav-link');
            
            // Toggle menu mobile
            navToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
                navToggle.classList.toggle('active');
            });
            
            // Fermer le menu en cliquant sur un lien
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    navMenu.classList.remove('active');
                    navToggle.classList.remove('active');
                });
            });
            
            // Marquer le lien actif
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
            
            // Fermer le menu en cliquant à l'extérieur
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.nav-bar')) {
                    navMenu.classList.remove('active');
                    navToggle.classList.remove('active');
                }
            });
        });

        // Données de l'élève (exemple)
        let studentData = {
            id: 1,
            firstName: 'Léa',
            lastName: 'Martin',
            birthDate: '2015-03-15',
            level: 'CM1',
            teacher: 'Mme Dubois',
            class: 'CM1-A',
            evaluations: [],
            comments: [],
            family: {
                father: {
                    name: 'Pierre Martin',
                    phone: '06 12 34 56 78',
                    email: 'pierre.martin@email.com',
                    profession: 'Ingénieur'
                },
                mother: {
                    name: 'Sophie Martin',
                    phone: '06 98 76 54 32',
                    email: 'sophie.martin@email.com',
                    profession: 'Professeure'
                },
                address: '12 rue de la Paix\n75001 Paris',
                siblings: '1 frère (Tom, 6 ans)'
            }
        };

        let selectedEvalLevel = '';

        // Navigation entre onglets
        function showTab(tabName) {
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Désactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Afficher le contenu sélectionné
            document.getElementById(tabName).classList.add('active');
            
            // Activer l'onglet correspondant
            event.target.classList.add('active');
        }

        // Calcul de l'âge
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        // Formatage de la date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR');
        }

        // Chargement des données de l'élève
        function loadStudentData() {
            // Mettre à jour les informations de base
            document.getElementById('studentFullName').textContent = `${studentData.firstName} ${studentData.lastName}`;
            document.getElementById('studentDetails').textContent = `${studentData.level} - ${calculateAge(studentData.birthDate)} ans - Née le ${formatDate(studentData.birthDate)}`;
            
            // Mettre à jour l'affichage de la photo
            updatePhotoDisplay();
            
            // Emoji en fonction du genre (simplification)
            const emoji = studentData.firstName.endsWith('a') || studentData.firstName.endsWith('e') ? '👧' : '👦';
            if (!studentData.photoEmoji) {
                studentData.photoEmoji = emoji;
            }
        }

        // Génération de commentaire depuis le profil
        function generateComment() {
            // Créer les paramètres pour le générateur
            const params = new URLSearchParams({
                name: studentData.firstName,
                level: studentData.level,
                fromProfile: true
            });
            
            // Redirection vers le générateur avec les paramètres
            window.location.href = `improved_lsu_generator.html?${params.toString()}`;
        }

        // Gestion des évaluations
        function openEvaluationModal() {
            document.getElementById('evaluationModal').style.display = 'block';
            document.getElementById('evaluationDate').value = new Date().toISOString().split('T')[0];
        }

        function closeEvaluationModal() {
            document.getElementById('evaluationModal').style.display = 'none';
            resetEvaluationForm();
        }

        function resetEvaluationForm() {
            document.getElementById('evaluationDate').value = '';
            document.getElementById('evaluationSubject').value = 'francais';
            document.getElementById('evaluationDomain').value = '';
            document.getElementById('evaluationComment').value = '';
            selectedEvalLevel = '';
            
            // Reset des boutons de niveau
            document.querySelectorAll('.eval-level-btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
        }

        function selectEvalLevel(level) {
            selectedEvalLevel = level;
            
            // Reset tous les boutons
            document.querySelectorAll('.eval-level-btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            
            // Activer le bouton sélectionné
            const selectedBtn = document.querySelector(`[data-level="${level}"]`);
            selectedBtn.classList.remove('btn-secondary');
            selectedBtn.classList.add('btn-primary');
        }

        function saveEvaluation() {
            const date = document.getElementById('evaluationDate').value;
            const subject = document.getElementById('evaluationSubject').value;
            const domain = document.getElementById('evaluationDomain').value;
            const comment = document.getElementById('evaluationComment').value;

            if (!date || !selectedEvalLevel) {
                showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }

            const newEvaluation = {
                id: Date.now(),
                date: date,
                subject: subject,
                domain: domain || subject,
                level: selectedEvalLevel,
                comment: comment,
                createdAt: new Date().toISOString()
            };

            // Ajouter l'évaluation aux données
            studentData.evaluations.push(newEvaluation);
            
            // Sauvegarder dans le localStorage
            saveStudentData();
            
            // Fermer le modal
            closeEvaluationModal();
            
            // Rafraîchir l'affichage
            loadEvaluationsHistory();
            
            showNotification('Évaluation enregistrée avec succès !', 'success');
        }

        // Gestion de l'édition du profil
        function editStudent() {
            document.getElementById('editModal').style.display = 'block';
            
            // Pré-remplir le formulaire
            document.getElementById('editFirstName').value = studentData.firstName;
            document.getElementById('editLastName').value = studentData.lastName;
            document.getElementById('editBirthDate').value = studentData.birthDate;
            document.getElementById('editLevel').value = studentData.level;
            document.getElementById('editTeacher').value = studentData.teacher || '';
            document.getElementById('editClass').value = studentData.class || '';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function saveStudentProfile() {
            studentData.firstName = document.getElementById('editFirstName').value;
            studentData.lastName = document.getElementById('editLastName').value;
            studentData.birthDate = document.getElementById('editBirthDate').value;
            studentData.level = document.getElementById('editLevel').value;
            studentData.teacher = document.getElementById('editTeacher').value;
            studentData.class = document.getElementById('editClass').value;

            // Sauvegarder les données
            saveStudentData();
            
            // Recharger l'affichage
            loadStudentData();
            
            closeEditModal();
            showNotification('Profil mis à jour avec succès !', 'success');
        }

        // Chargement de l'historique des évaluations
        function loadEvaluationsHistory() {
            const timeline = document.getElementById('evaluationsTimeline');
            if (!timeline) return;
            
            const evaluations = studentData.evaluations || [];
            
            if (evaluations.length === 0) {
                timeline.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <p>Aucune évaluation pour le moment.</p>
                        <p>Cliquez sur "Ajouter une évaluation" pour commencer.</p>
                    </div>
                `;
                return;
            }
            
            timeline.innerHTML = evaluations.map(eval => {
                const levelColors = {
                    'insufficient': '#f44336',
                    'fragile': '#ff9800',
                    'satisfactory': '#4CAF50',
                    'excellent': '#2196F3'
                };
                
                const levelLabels = {
                    'insufficient': 'Maîtrise insuffisante',
                    'fragile': 'Maîtrise fragile',
                    'satisfactory': 'Maîtrise satisfaisante',
                    'excellent': 'Très bonne maîtrise'
                };
                
                return `
                    <div style="position: relative; margin-bottom: 30px;">
                        <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: ${levelColors[eval.level]}; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 2px ${levelColors[eval.level]}20;"></div>
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-left: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: #333;">${eval.domain}</h4>
                                <span style="background: ${levelColors[eval.level]}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${levelLabels[eval.level]}</span>
                            </div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 8px;">
                                <strong>Date :</strong> ${new Date(eval.date).toLocaleDateString('fr-FR')} | 
                                <strong>Matière :</strong> ${eval.subject}
                            </div>
                            ${eval.comment ? `<p style="color: #333; line-height: 1.4; margin: 0;">${eval.comment}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Sauvegarde des données de l'élève
        function saveStudentData() {
            localStorage.setItem(`student_${studentData.id}`, JSON.stringify(studentData));
        }

        // Chargement des données de l'élève depuis le localStorage
        function loadStudentDataFromStorage() {
            const saved = localStorage.getItem(`student_${studentData.id}`);
            if (saved) {
                studentData = { ...studentData, ...JSON.parse(saved) };
            }
        }

        // Retour à la liste
        function goBack() {
            // Redirection vers la page d'accueil
            window.location.href = 'lsu_index.html';
        }

        // Système de notifications
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Navigation mobile
        function toggleMobileMenu() {
            const menu = document.getElementById('navMenu');
            menu.classList.toggle('active');
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les données depuis l'URL ou le localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const studentId = urlParams.get('id');
            
            if (studentId) {
                studentData.id = studentId;
                loadStudentDataFromStorage();
            }
            
            loadStudentData();
            
            // Charger les commentaires et évaluations
            loadComments();
            loadEvaluationsHistory();
            
            // Définir la date d'aujourd'hui par défaut
            document.getElementById('evaluationDate').value = new Date().toISOString().split('T')[0];
        });

        // Fermer les modals en cliquant à l'extérieur
        window.onclick = function(event) {
            const evaluationModal = document.getElementById('evaluationModal');
            const editModal = document.getElementById('editModal');
            const photoModal = document.getElementById('photoModal');
            
            if (event.target === evaluationModal) {
                closeEvaluationModal();
            } else if (event.target === editModal) {
                closeEditModal();
            } else if (event.target === photoModal) {
                closePhotoModal();
            }
        }

        // Gestion du clavier pour les modals
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeEvaluationModal();
                closeEditModal();
                closePhotoModal();
            }
        });

        // ===== NOUVELLES FONCTIONS POUR IMPORT/EXPORT =====

        // Gestion de l'import de fichiers
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            if (fileExtension === 'csv') {
                handleCSVImport(file);
            } else if (fileExtension === 'xlsx') {
                handleXLSXImport(file);
            } else {
                showNotification('Format de fichier non supporté. Utilisez CSV ou XLSX.', 'error');
            }
        }

        // Import CSV
        function handleCSVImport(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    const students = [];
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',').map(v => v.trim());
                            const student = {};
                            headers.forEach((header, index) => {
                                student[header] = values[index] || '';
                            });
                            students.push(student);
                        }
                    }
                    
                    // Sauvegarder les élèves importés
                    saveImportedStudents(students);
                    showNotification(`${students.length} élèves importés avec succès !`, 'success');
                    
                } catch (error) {
                    showNotification('Erreur lors de la lecture du fichier CSV', 'error');
                    console.error('Erreur CSV:', error);
                }
            };
            reader.readAsText(file);
        }

        // Import XLSX (simulation - nécessiterait une librairie comme SheetJS)
        function handleXLSXImport(file) {
            showNotification('Import XLSX en cours de développement. Utilisez le format CSV pour l\'instant.', 'warning');
            // Ici on pourrait intégrer SheetJS pour lire les fichiers Excel
            // https://github.com/SheetJS/sheetjs
        }

        // Sauvegarde des élèves importés
        function saveImportedStudents(students) {
            const existingStudents = JSON.parse(localStorage.getItem('students_list') || '[]');
            const updatedStudents = [...existingStudents, ...students];
            localStorage.setItem('students_list', JSON.stringify(updatedStudents));
        }

        // Gestion de l'export
        function handleExport() {
            // Créer un menu d'export
            const exportMenu = document.createElement('div');
            exportMenu.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                min-width: 300px;
            `;
            
            exportMenu.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">📤 Exporter la liste des élèves</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button onclick="exportStudentList()" style="background: #28a745; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                        📄 Exporter en CSV
                    </button>
                    <button onclick="exportToExcel()" style="background: #007bff; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                        📊 Exporter en Excel
                    </button>
                    <button onclick="exportToPDF()" style="background: #dc3545; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                        📋 Exporter en PDF
                    </button>
                    <button onclick="closeExportMenu()" style="background: #6c757d; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                        ❌ Annuler
                    </button>
                </div>
            `;
            
            exportMenu.id = 'exportMenu';
            document.body.appendChild(exportMenu);
        }

        // Fermer le menu d'export
        function closeExportMenu() {
            const menu = document.getElementById('exportMenu');
            if (menu) {
                document.body.removeChild(menu);
            }
        }

        // Export en CSV
        function exportStudentList() {
            // Récupérer la liste des élèves depuis le localStorage
            const students = JSON.parse(localStorage.getItem('students_list') || '[]');
            
            if (students.length === 0) {
                showNotification('Aucun élève à exporter. Créez d\'abord des élèves.', 'warning');
                closeExportMenu();
                return;
            }
            
            // Créer le contenu CSV
            const headers = ['Prénom', 'Nom', 'Date de naissance', 'Niveau', 'Classe', 'Enseignant'];
            const csvContent = [
                headers.join(','),
                ...students.map(student => [
                    student.firstName || student.prénom || '',
                    student.lastName || student.nom || '',
                    student.birthDate || student.dateNaissance || '',
                    student.level || student.niveau || '',
                    student.class || student.classe || '',
                    student.teacher || student.enseignant || ''
                ].join(','))
            ].join('\n');
            
            // Télécharger le fichier
            downloadFile(csvContent, 'liste_eleves.csv', 'text/csv');
            showNotification('Liste des élèves exportée avec succès !', 'success');
        }

        // Export en Excel (simulation - génère un CSV avec extension .xlsx)
        function exportToExcel() {
            showNotification('Export Excel en cours de développement. Le fichier sera téléchargé au format CSV.', 'warning');
            exportStudentList(); // Pour l'instant, on utilise CSV
            closeExportMenu();
        }

        // Export en PDF
        function exportToPDF() {
            const students = JSON.parse(localStorage.getItem('students_list') || '[]');
            
            if (students.length === 0) {
                showNotification('Aucun élève à exporter', 'warning');
                closeExportMenu();
                return;
            }
            
            // Créer le contenu HTML pour le PDF
            let htmlContent = `
                <html>
                <head>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .header { text-align: center; margin-bottom: 30px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>📋 Liste des élèves - École ECOLE DU CAP</h1>
                        <p>Export généré le ${new Date().toLocaleDateString('fr-FR')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Prénom</th>
                                <th>Nom</th>
                                <th>Date de naissance</th>
                                <th>Niveau</th>
                                <th>Classe</th>
                                <th>Enseignant</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            students.forEach(student => {
                htmlContent += `
                    <tr>
                        <td>${student.firstName || student.prénom || ''}</td>
                        <td>${student.lastName || student.nom || ''}</td>
                        <td>${student.birthDate || student.dateNaissance || ''}</td>
                        <td>${student.level || student.niveau || ''}</td>
                        <td>${student.class || student.classe || ''}</td>
                        <td>${student.teacher || student.enseignant || ''}</td>
                    </tr>
                `;
            });
            
            htmlContent += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            // Ouvrir dans une nouvelle fenêtre pour impression
            const printWindow = window.open('', '_blank');
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            printWindow.print();
            
            closeExportMenu();
            showNotification('Export PDF prêt pour impression !', 'success');
        }

        // Fonction utilitaire pour télécharger un fichier
        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Fonction pour ajouter un commentaire
        function addComment() {
            const commentText = prompt('Entrez votre commentaire :');
            if (commentText && commentText.trim()) {
                const comment = {
                    id: Date.now(),
                    date: new Date().toLocaleDateString('fr-FR'),
                    text: commentText.trim(),
                    type: 'general'
                };
                
                // Ajouter aux données de l'élève
                if (!studentData.comments) {
                    studentData.comments = [];
                }
                studentData.comments.push(comment);
                
                // Sauvegarder
                saveStudentData();
                
                // Rafraîchir l'affichage
                loadComments();
                
                showNotification('Commentaire ajouté avec succès !', 'success');
            }
        }

        // Fonction pour charger les commentaires
        function loadComments() {
            const commentsList = document.getElementById('commentsList');
            if (!commentsList) return;
            
            const comments = studentData.comments || [];
            
            if (comments.length === 0) {
                commentsList.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <p>Aucun commentaire pour le moment.</p>
                        <p>Cliquez sur "Ajouter un commentaire" pour commencer.</p>
                    </div>
                `;
                return;
            }
            
            commentsList.innerHTML = comments.map(comment => `
                <div class="comment-item" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4CAF50;">
                    <div style="font-weight: 600; color: #4CAF50; margin-bottom: 8px;">${comment.date} - Commentaire</div>
                    <p style="color: #333; line-height: 1.6;">${comment.text}</p>
                </div>
            `).join('');
        }

        // Fonction pour afficher le modal de la photo
        function showPhotoModal() {
            console.log('showPhotoModal appelée');
            const modal = document.getElementById('photoModal');
            const modalPhotoImg = document.getElementById('modalPhotoImg');
            const modalPhotoEmoji = document.getElementById('modalPhotoEmoji');
            
            if (!modal) {
                console.error('Modal photo non trouvé');
                return;
            }
            
            // Afficher la photo actuelle dans le modal
            if (studentData.photoUrl) {
                modalPhotoImg.src = studentData.photoUrl;
                modalPhotoImg.style.display = 'block';
                modalPhotoEmoji.style.display = 'none';
            } else {
                modalPhotoEmoji.textContent = studentData.photoEmoji || '👧';
                modalPhotoImg.style.display = 'none';
                modalPhotoEmoji.style.display = 'block';
            }
            
            // Afficher le modal avec animation
            modal.style.display = 'block';
            modal.classList.add('show');
            
            // Empêcher le scroll du body
            document.body.style.overflow = 'hidden';
            
            console.log('Modal photo affiché');
        }

        // Fonction pour fermer le modal photo
        function closePhotoModal() {
            console.log('closePhotoModal appelée');
            const modal = document.getElementById('photoModal');
            
            if (!modal) {
                console.error('Modal photo non trouvé');
                return;
            }
            
            // Fermer le modal avec animation
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                // Restaurer le scroll du body
                document.body.style.overflow = 'auto';
            }, 300);
            
            console.log('Modal photo fermé');
        }

        // Fermer le modal en cliquant à l'extérieur
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('photoModal');
            if (event.target === modal) {
                closePhotoModal();
            }
        });

        // Fermer le modal avec la touche Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('photoModal');
                if (modal && modal.style.display === 'block') {
                    closePhotoModal();
                }
            }
        });

        // Fonction pour éditer la photo
        function editPhoto() {
            console.log('editPhoto appelée');
            showPhotoModal();
        }

        // Fonction pour gérer l'upload de photo
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Vérifier le type de fichier
            if (!file.type.startsWith('image/')) {
                showNotification('Veuillez sélectionner une image valide', 'error');
                return;
            }

            // Vérifier la taille (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('L\'image est trop volumineuse (max 5MB)', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const photoUrl = e.target.result;
                
                // Afficher la preview
                const modalPhotoImg = document.getElementById('modalPhotoImg');
                const modalPhotoEmoji = document.getElementById('modalPhotoEmoji');
                
                modalPhotoImg.src = photoUrl;
                modalPhotoImg.style.display = 'block';
                modalPhotoEmoji.style.display = 'none';
                
                // Sauvegarder temporairement
                studentData.photoUrl = photoUrl;
                studentData.photoEmoji = null;
                
                showNotification('Photo chargée avec succès !', 'success');
            };
            
            reader.readAsDataURL(file);
        }

        // Fonction pour sélectionner un emoji
        function selectEmoji(emoji) {
            const modalPhotoImg = document.getElementById('modalPhotoImg');
            const modalPhotoEmoji = document.getElementById('modalPhotoEmoji');
            
            // Afficher l'emoji dans le modal
            modalPhotoEmoji.textContent = emoji;
            modalPhotoImg.style.display = 'none';
            modalPhotoEmoji.style.display = 'block';
            
            // Sauvegarder temporairement
            studentData.photoEmoji = emoji;
            studentData.photoUrl = null;
            
            // Mettre à jour la sélection visuelle
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // Fonction pour supprimer la photo
        function removePhoto() {
            const modalPhotoImg = document.getElementById('modalPhotoImg');
            const modalPhotoEmoji = document.getElementById('modalPhotoEmoji');
            
            // Réinitialiser à l'emoji par défaut
            const defaultEmoji = studentData.firstName.endsWith('a') || studentData.firstName.endsWith('e') ? '👧' : '👦';
            modalPhotoEmoji.textContent = defaultEmoji;
            modalPhotoImg.style.display = 'none';
            modalPhotoEmoji.style.display = 'block';
            
            // Supprimer les données de photo
            studentData.photoUrl = null;
            studentData.photoEmoji = defaultEmoji;
            
            showNotification('Photo supprimée', 'success');
        }

        // Fonction pour sauvegarder la photo
        function savePhoto() {
            // Sauvegarder les données
            saveStudentData();
            
            // Mettre à jour l'affichage
            updatePhotoDisplay();
            
            // Fermer le modal
            closePhotoModal();
            
            showNotification('Photo sauvegardée avec succès !', 'success');
        }

        // Fonction pour mettre à jour l'affichage de la photo
        function updatePhotoDisplay() {
            const studentPhotoImg = document.getElementById('studentPhotoImg');
            const studentPhotoEmoji = document.getElementById('studentPhotoEmoji');
            
            if (studentData.photoUrl) {
                studentPhotoImg.src = studentData.photoUrl;
                studentPhotoImg.style.display = 'block';
                studentPhotoEmoji.style.display = 'none';
            } else {
                studentPhotoImg.style.display = 'none';
                studentPhotoEmoji.style.display = 'block';
                studentPhotoEmoji.textContent = studentData.photoEmoji || '👧';
            }
        }
    </script>
</body>
</html>